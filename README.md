# Preprocessing of data

## trusTEr
For the snRNAseq, we ran trusTEr 5 times:

1. Fetal samples grouped: Pseudobulk per clusters
2. Fetal samples individually: Pseudobulk per cluster
3. Fetal samples grouped: Pseudobulk per cluster and cell type state
4. Adult samples grouped (3' 10x): Pseudobulk per clusters 
5. Adult samples grouped (5' 10x): Pseudobulk per clusters 

## Pipelines
There are three pipelines that were used to preprocess bulk RNAseq using short reads (Snakefile_bulkRNAseq), long reads (Snakefile_pacbio), and the CUT&RUN data (Snakefile_cutnrun_pt1 and pt2).

### Snakefile_bulkRNAseq

This pipeline was used to analyse the fetal and adult samples, as well as the linc10876 crispri experiment in fbNPCs, and the publicly available data of human and chimp fbNPCs (Johansson et al., 2022). 

### Snakefile_cutnrun_pt1 and pt2

These pipelines were used to analyse the fetal and adult H3K4me3 CUT&RUN samples. 

Pt1 pipeline is meant to be run first. This pipeline trims, performs QC, maps, filters, sorts, generates bigwig files, and generates the tag directories used for peak calling. Note: Rule L1HS_L1PA2_peaks_matrices_RNAseq_h3k4me3 should not be run the first time. 

Pt2 pipeline then makes peak calling, annotates the peaks and creates the bed files of intersected peaks with >6kbp L1HS, L1PA2, L1PA3, and L1PA4 that were detected in all samples. These bed files are the input of the rule L1HS_L1PA2_peaks_matrices_RNAseq_h3k4me3 (from Snakefile_cutnrun_pt1).

Finally, the rule L1HS_L1PA2_peaks_matrices_RNAseq_h3k4me3 from Snakefile_cutnrun_pt1 should be run to create the matrices for the heatmaps.

The configuration files for these are a big different. I've added the configuration files using the fetal samples as an example (config_files/config_cutnrun_pt1.yaml and config_files/config_cutnrun_pt2.json). However, the same pipelines were ran for the adult samples using similar configuration files.

### Snakefile_pacbio

We ran this small pipeline to map the Isoseq reads to the consensus sequence of L1HS and L1PA2. 

### Snakefile_snRNAseq_pseudobulk

This pipeline is meant to take the BAM files generated by trusTEr (one BAM file per cluster), index, filter by strand, and convert to bigwig files using a normalization factor of 1e+7/num of cells in cluster. It also generates the matrix file for the heatmaps shown in suppl figure 2.

# Analysis

Rmarkdowns of each dataset or technology can be found in this directory. 

We used yy1_present.py to classify the elements into those with an YY1 binding site present or not.